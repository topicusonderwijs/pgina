<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--

	zenlike1.0 by nodethirtythree design
	http://www.nodethirtythree.com

-->
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>pGina fork</title>
<meta name="keywords" content="" />
<meta name="description" content="" />

<link rel="stylesheet" type="text/css" href="http://mutonufoai.github.io/pgina/default_doc.css" />

</head>
<body>

<div id="outer">

	<div id="header">
		<div id="headercontent">
			<h1>pGina fork</h1>
			<h2>Open Source Windows Authentication</h2>
		</div>
		<div id="logo"><a href="http://mutonufoai.github.io/pgina/index.html"><img src="http://mutonufoai.github.io/pgina/images/pginalogo.png" /></a></div>
	</div>

	
	<div id="menu">
		<!-- HINT: Set the class of any menu link below to "active" to make it appear active -->
		<ul>
			<li><a href="http://mutonufoai.github.io/pgina/index.html">Home</a></li>
			<li><a href="http://mutonufoai.github.io/pgina/download.html">Download</a></li>
      <li><a href="http://mutonufoai.github.io/pgina/support.html">Support</a></li>
      <li><a href="http://mutonufoai.github.io/pgina/documentation.html" class="active">Documentation</a></li>
      <li><a href="http://mutonufoai.github.io/pgina/develop.html">Develop</a></li>
      <li><a href="http://mutonufoai.github.io/pgina/faq.html">FAQ</a></li>
      <li><a href="http://mutonufoai.github.io/pgina/thanks.html">Thanks</a></li>
		</ul>
	</div>

	<div id="menubottom"></div>

	<div id="content">
	    
	    
		
			
<h1 id="ldap_plugin_documentation">LDAP Plugin Documentation</h1>

<ul>
<li><strong>Plugin Name:</strong> LDAP</li>

<li><strong>Plugin Type:</strong> Authentication, Authorization, Gateway, Change Password</li>

<li><strong>Version:</strong> 3.2.0</li>
</ul>

<h2 id="fork_diff">Fork diff</h2>

<ul>
<li>You can import LDAP attributes into pGina using the attribute converter</li>

<li>In the authorization and gateway stages you can create your own query</li>

<li>More password change methods are available</li>
</ul>

<h2 id="how_the_ldap_plugin_works">How the LDAP Plugin Works</h2>

<p>The LDAP plugin provides pGina services using an LDAP server as the primary data source. It provides support for SSL encryption and failover to one or more alternate servers.</p>

<h3 id="authentication">Authentication</h3>

<p>In the authentication stages, this plugin maps the user name to a LDAP Distinguished Name (DN) and attempts to bind to the LDAP server using the DN. If the bind is successful, it provides a positive result to the pGina service.</p>

<p>The user name can be mapped to a DN by one of two means: simple pattern substitution, or via a search of the LDAP database. When a search is used, the plugin connects to the LDAP server anonymously (or via supplied credentials) and attempts to find an entry for the user. If the entry is found, the plugin closes the connection and attempts to bind again using the DN of the entry, and the password provided by the user. If this bind is successful, the plugin registers success.</p>

<h4 id="attribute_converter">Attribute converter</h4>

<p><span class='greenbg'>
Since fork 3.2.0.0<br />
During Authentication you can map LDAP to pGina attributes, like LDAP cn to pGina Fullname
</span></p>

<h3 id="authorization">Authorization</h3>

<p><span class='redbg'>In the authorization stage the LDAP plugin can authorize users based on membership in LDAP groups. The plugin searches the LDAP tree for group membership and allows or denies based on a set of rules that can be configured via the configuration interface (see below).</span></p>

<p><span class='greenbg'>
Since fork 3.2.0.0<br />
Instead of restricting a query to a group membership only you are now free in your query.
</span></p>

<p>If the LDAP server cannot be contacted, it can be configured to allow or deny access. It can also be configured to deny if the LDAP plugin fails in the authentication stage.</p>

<h3 id="gateway">Gateway</h3>

<p><span class='redbg'>In the gateway stage, this plugin can add the user to local groups based on membership in LDAP groups. The plugin will search the LDAP tree for group membership then add the user to local groups based on a set of rules (see below). A common use for this is to add the user to the local Administrators group when the user is a member of a given LDAP admin group.</span></p>

<p><span class='greenbg'>
Since fork 3.2.0.0<br />
Instead of restricting a query to a group membership only you are now free in your query.
</span></p>

<h3 id="password">Password</h3>

<p>This is’nt a stage during login, its more an event that is triggered during a password change. You can determine which LDAP attribute need to change during a pasword reset</p>

<p><strong>The password change event is only triggered if the user is using CTRL+ALT+DEL or CTRL+ALT+END.</strong></p>

<p><span class='greenbg'>
You can choose more methods<br />
<strong>hashing:</strong> MD5, salted MD5, LM<br />
<strong>timestamp:</strong> days or seconds since 1970
</span></p>

<h2 id="typical_setup">Typical Setup</h2>

<p>A typical (minimal) setup for LDAP authentication is to enable the Local Machine plugin in the authentication and gateway stages, and enable LDAP in the authentication stage. Within the authentication stage, order the LDAP plugin before Local Machine.</p>

<h2 id="configuration">Configuration</h2>

<p>The configuration interface for the LDAP plugin is shown below.</p>

<p><img src="http://mutonufoai.github.io/pgina/images/documentation/plugins/ldap_plugin_config.png" alt="LDAP configuration" /></p>

<p>The configuration options are described below:</p>

<ul>
<li><strong>LDAP Host(s):</strong> – A space separated list of one or more LDAP servers. This field supports IP addresses or fully qualified domain names.</li>

<li><strong>LDAP Port</strong> – The port used when connecting to the LDAP server(s). Typically, this is 389 for non-SSL connections (or connections using StartTLS), and 636 when SSL is used.</li>

<li><strong>Timeout</strong> – This is the number of seconds to wait for a response from a server before giving up (and possibly moving on to the next server in the list).</li>

<li><strong>Use SSL</strong> – Whether or not to use SSL encryption when connecting to the server(s).</li>

<li><strong>Use TLS</strong> – Whether or not to use TLS encryption when connecting to the server(s).</li>

<li><strong>Verify Server Certificate</strong> – Whether or not to verify the server’s public certificate with a local certificate or certificate store. When this option is selected, the connection will fail if the server’s certificate does not validate.</li>

<li><strong>SSL/TLS Certificate</strong> (optional) – If you have selected “Verify Server Certificate,” you can provide a copy of the server’s public SSL/TLS certificate here. The certificate should be provided in the “PEM” format that is the default for OpenSSL. If this field is left blank, the plugin will attempt to use the Windows certificate store to validate the certificate.</li>

<li><strong>Search DN</strong> – The DN to use when binding to the server in order to perform searches. If this is left empty, the plugin will attempt to bind anonymously. This is used for searching for group membership or for searching for a user’s DN.</li>

<li><strong>Search Password</strong> – The password to use when binding with the above DN.<br />This is ignored if the “Search DN” field is empty (anonymous bind).</li>

<li><strong>bind with user credentials instead of anonymously</strong> – Use authentication credentials when searching for groups in the authorization and gateway stages.</li>
</ul>

<h3 id="authentication_options">Authentication Options</h3>

<p><img src="http://mutonufoai.github.io/pgina/images/documentation/plugins/ldap_plugin_bind.png" alt="LDAP configuration" /></p>

<ul>
<li><strong>Allow Empty Passwords</strong> – If this is checked, the plugin will attempt to authenticate the user even if the password is empty. When unchecked, it will fail to authenticate the user without attempting to bind to the LDAP server. Note that some servers may treat an empty password as an anonymous bind, so it is a good idea to leave this unchecked (the default).</li>

<li><strong>DN Pattern</strong> – If “Search for DN” is not selected, the user name is mapped to a DN using this pattern. The substring <code>%u</code> will be replaced with the user name.</li>

<li><strong>Search for DN</strong> – When this option is selected, the “DN Pattern” (mentioned above) is ignored. Instead, the plugin will attempt to connect to the LDAP server (using the <code>Search DN</code> and <code>Search Password</code> credentials), and search for an entry using the Search Filter and Search Context(s) provided. If the entry is found, the DN for the entry is used to re-bind to the server. If the re-bind succeeds, the plugin registers success.</li>

<li><strong>Search Filter</strong> – This is a LDAP search filter to be used when searching for the DN. For more information on LDAP search filters, see <a href="http://tools.ietf.org/html/rfc4515">this RFC</a>, or any LDAP book. If the string <code>%u</code> appears in the filter, it will be replaced by the user name.</li>

<li><strong>Search Context(s)</strong> – This is a list of DNs (one per line) that are to be used as search contexts. This means that the search will be performed on the LDAP subtree rooted at each of these DNs.</li>
</ul>

<h4 id="attribute_converter_options">Attribute converter Options</h4>

<p><img src="http://mutonufoai.github.io/pgina/images/documentation/plugins/ldap_plugin_attrib.png" alt="LDAP attribute configuration" /></p>

<p><strong>Windows</strong> – The pGina internal attribute name</p>

<ul>
<li>Fullname – The Full Name for this user</li>

<li>usri4_max_storage – profile space limit the user can use (GPO setting)</li>

<li>usri4_profile – The path to the roaming profile</li>

<li>usri4_home_dir_drive – The home drive name</li>

<li>usri4_home_dir – The path to the home drive</li>

<li>Email – users email address</li>

<li>LoginScript – The path to the users login script</li>

<li>pgSMB_Filename – Used in pgSMB plugin only to specify the compressed profile name</li>

<li>pgSMB_SMBshare – Used in pgSMB plugin only to specify the SMB share</li>
</ul>

<p><strong>LDAP</strong> – The attribute name in your LDAP</p>

<h3 id="authorization_options">Authorization Options</h3>

<p><img src="http://mutonufoai.github.io/pgina/images/documentation/plugins/ldap_plugin_auth.png" alt="LDAP configuration" /></p>

<p>The authorization tab provides an interface for creating, removing, and deleting authorization rules. The rules are tested by the plugin in order and the first matching rule is applied. If none of the rules match, the default rule is applied. The default is configured using the radio buttons at the top of the tab interface.</p>

<p>The other configuration options are described below:</p>

<ul>
<li><strong>Default</strong> – If none of the rules match, the default rule is applied</li>

<li><strong>Deny when LDAP authentication fails</strong> – If this is checked, authorization fails when the LDAP plugin fails to authenticate the user in the authentication stage or the LDAP plugin does not execute in that stage.</li>

<li><strong>Allow when server is unreachable</strong> – When this is checked, the plugin will allow (succeed authorization) when the LDAP server is unavailable or some other error occurs that causes a failure to contact the LDAP server. If this is unchecked, the user is denied authorization under the same circumstaces.</li>
</ul>

<h3 id="gateway_options">Gateway Options</h3>

<p><img src="http://mutonufoai.github.io/pgina/images/documentation/plugins/ldap_plugin_gate.png" alt="LDAP configuration" /></p>

<p>The gateway tab provides options for creating and removing rules for adding local groups based on LDAP group membership. The rules are all applied in order from top to bottom. All rules are applied regardless of how many are a match for the user logging in.</p>

<p>When users are removed from LDAP groups, they may not be removed from the local groups without careful configuration of the LocalMachine plugin. For this to work properly, you should make sure to configure the LocalMachine plugin to scramble passwords and/or to remove accounts and profiles after logout. This will make sure that the LocalMachine plugin does not retain group information on consecutive logins. For more information, see the documentation for the LocalMachine plugin.</p>

<p>Note that it is important to make sure that this plugin executes prior to the LocalMachine plugin in the gateway stage. This is because the LocalMachine plugin is responsible for actually adding the local account to the local groups. If it executes prior to the LDAP plugin, it will not apply the groups that have been added by this plugin.</p>

<h3 id="change_password">Change Password</h3>

<p><img src="http://mutonufoai.github.io/pgina/images/documentation/plugins/ldap_plugin_password.png" alt="LDAP configuration" /></p>

<p>The Change Password tab provides an interface for manipulating LDAP values in case of a password change event. The password change event is only triggered if the user is using CTRL+ALT+DEL or CTRL+ALT+END.</p>

<p><strong>Method</strong></p>

<ul>
<li>Plain Text – a plain text password, designed for LDAP attribute <strong>userPassword</strong></li>

<li>MD5 – an MD5 hash password, designed for LDAP attribute <strong>userPassword</strong></li>

<li>SMD5 – a salted MD5 hash password, designed for LDAP attribute <strong>userPassword</strong></li>

<li>SHA1 – an SHA1 hash password, designed for LDAP attribute <strong>userPassword</strong></li>

<li>SSHA1 – a salted SHA1 password, designed for LDAP attribute <strong>userPassword</strong></li>

<li>NTLM – an NTLM password, designed for LDAP attribute <strong>sambaNTPassword</strong></li>

<li>LM – an LM password, designed for LDAP attribute <strong>sambaLMPassword</strong></li>

<li>Timestamp sec since ‘70 – seconds passed since 1970.01.01, designed for LDAP attribute <strong>sambaPwdLastSet</strong></li>

<li>Timestamp days since ‘70 – days passed since 1970.01.01, designed for LDAP attribute <strong>shadowLastChange</strong></li>
</ul>

<p>If you manipulate the attribute sambaPwdLastSet the attribute sambaPwdMustChange will also be changed:</p>

<ul>
<li>if there is an LDAP attribute shadowmax and sambapwdmustchange</li>

<li>the attribute shadowmax value is greater than 0</li>

<li>the C# <a href="https://github.com/MutonUfoAI/pgina/blob/a5dd8fbb2b52714eaa6fdb0263b1e9164bbcaa01/Plugins/LdapPlugin/Ldap/LdapServer.cs#L654">code</a></li>
</ul>

    
		
		<!-- Secondary content: Stuff that goes in the secondary content column (by default, the narrower right column) -->



	</div>

	<div id="footer">
			<div class="left">&copy; 2014 pgina.org</div>
			<div class="right">Original design by 
			<a href="http://www.nodethirtythree.com/">NodeThirtyThree Design</a></div>
	</div>
	
</div>

</body>
</html>

